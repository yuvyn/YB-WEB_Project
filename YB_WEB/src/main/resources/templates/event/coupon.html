<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>쿠폰 등록 | YB WEB</title>

    <link rel="stylesheet" th:href="@{/css/layout/header.css}">
    <link rel="stylesheet" th:href="@{/css/layout/footer.css}">
    <link rel="stylesheet" th:href="@{/css/board/coupon.css}">
</head>
<body>
<div class="page">
    <th:block th:replace="layout/header :: header"></th:block>

    <!-- 상단 쿠폰 HERO -->
    <section class="coupon-hero">
        <div class="coupon-hero-inner">
            <div class="coupon-hero-left">
                <div class="coupon-mascot">
                    <!-- 마스코트는 이미지로 바꾸고 싶으면 img 태그로 교체 -->
                    <div class="coupon-mascot-circle"></div>
                </div>
            </div>

            <div class="coupon-hero-right">
                <h1>YB WEB MOBILE COUPON</h1>
                <p class="coupon-hero-sub">
                    YB WEB 모바일에서 사용할 수 있는 쿠폰 코드를 등록해 주세요.
                </p>

                <form th:action="@{/coupon/register}" method="post" class="coupon-input-form">
                    <input type="text"
                           name="code"
                           maxlength="50"
                           placeholder="쿠폰 코드 입력"
                           required>
                    <button type="submit">확인</button>
                </form>

                <p class="coupon-guide-text">
                    • 쿠폰 코드는 대소문자를 구분하지 않습니다.<br>
                    • 사용 가능 쿠폰은 아래 <strong>‘사용 가능’</strong> 탭에서 확인할 수 있습니다.<br>
                    • 유효기간이 지난 쿠폰은 자동으로 <strong>‘사용 완료/기간 만료’</strong> 탭으로 이동합니다.
                </p>
            </div>
        </div>
    </section>

    <!-- 메시지 -->
    <section class="coupon-message" th:if="${message != null and !#strings.isEmpty(message)}">
        <div class="content-inner">
            <div class="coupon-alert" th:text="${message}"></div>
        </div>
    </section>

    <!-- 쿠폰 목록 영역 -->
    <section class="coupon-list-section">
        <div class="content-inner">

            <!-- 탭 -->
            <div class="coupon-tabs">
                <button class="tab-btn active" data-target="available">
                    사용 가능
                    (<span th:text="${#lists.size(availableCoupons)}">0</span>)
                </button>
                <button class="tab-btn" data-target="history">
                    사용 완료/기간 만료
                    (<span th:text="${#lists.size(historyCoupons)}">0</span>)
                </button>
            </div>

            <!-- 사용 가능 쿠폰 -->
            <div id="coupon-panel-available" class="coupon-panel active">
                <table class="coupon-table">
                    <thead>
                    <tr>
                        <th class="th-type">구분</th>
                        <th class="th-name">쿠폰명</th>
                        <th class="th-date">등록일</th>
                        <th class="th-date">만료일</th>
                        <th class="th-action">사용하기</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(availableCoupons)}">
                        <td colspan="5" class="empty-row">사용 가능한 쿠폰이 없습니다.</td>
                    </tr>
                    <tr th:each="c : ${availableCoupons}">
                        <td class="td-type">[쿠폰]</td>
                        <td class="td-name">
                            <strong th:text="${c.name}">쿠폰 이름</strong>
                            <div class="coupon-code" th:text="${c.code}">CODE-XXXX</div>
                        </td>
                        <td th:text="${#temporals.format(c.issuedAt, 'yyyy.MM.dd HH:mm')}">2025.11.14 17:07</td>
                        <td th:text="${c.expiredAt != null} ? ${#temporals.format(c.expiredAt, 'yyyy.MM.dd HH:mm')} : '-'">-</td>
                        <td>
                            <form th:action="@{'/coupon/use/' + ${c.id}}" method="post">
                                <button type="submit" class="btn-use">사용</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 사용 완료 / 기간 만료 -->
            <div id="coupon-panel-history" class="coupon-panel">
                <table class="coupon-table">
                    <thead>
                    <tr>
                        <th class="th-type">구분</th>
                        <th class="th-name">쿠폰명</th>
                        <th class="th-date">등록/사용일</th>
                        <th class="th-date">만료일</th>
                        <th class="th-action">상태</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(historyCoupons)}">
                        <td colspan="5" class="empty-row">사용 완료 또는 기간 만료된 쿠폰이 없습니다.</td>
                    </tr>
                    <tr th:each="c : ${historyCoupons}">
                        <td class="td-type">[쿠폰]</td>
                        <td class="td-name">
                            <strong th:text="${c.name}">쿠폰 이름</strong>
                            <div class="coupon-code" th:text="${c.code}">CODE-XXXX</div>
                        </td>
                        <td th:text="${c.usedAt != null} ? ${#temporals.format(c.usedAt, 'yyyy.MM.dd HH:mm')} : ${#temporals.format(c.issuedAt, 'yyyy.MM.dd HH:mm')}">
                            2025.11.14 17:07
                        </td>
                        <td th:text="${c.expiredAt != null} ? ${#temporals.format(c.expiredAt, 'yyyy.MM.dd HH:mm')} : '-'">-</td>
                        <td>
                            <span th:if="${c.status.name() == 'USED'}" class="badge badge-used">사용 완료</span>
                            <span th:if="${c.status.name() == 'EXPIRED'}" class="badge badge-expired">기간 만료</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </section>

    <th:block th:replace="layout/footer :: footer"></th:block>
</div>

<script>
    // 탭 전환 스크립트
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll('.coupon-tabs .tab-btn');
        const panels = {
            available: document.getElementById('coupon-panel-available'),
            history: document.getElementById('coupon-panel-history')
        };

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.target;

                tabButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                Object.keys(panels).forEach(key => {
                    panels[key].classList.remove('active');
                });
                panels[target].classList.add('active');
            });
        });
    });
</script>
</body>
</html>