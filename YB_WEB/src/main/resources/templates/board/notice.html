<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>공지사항 - YB WEB</title>

    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- 공통 레이아웃 CSS -->
    <link rel="stylesheet" th:href="@{/css/layout/header.css}">
    <link rel="stylesheet" th:href="@{/css/layout/footer.css}">

    <!-- 공지사항도 업데이트 CSS 재사용 -->
    <link rel="stylesheet" th:href="@{/css/board/notice.css}">
</head>
<body class="board-page">

<div class="page">

    <!-- 공통 헤더 -->
    <th:block th:replace="layout/header :: header"></th:block>

    <!-- 메인 영역 -->
    <main class="board-main">

        <!-- 상단 타이틀 -->
        <section class="board-header">
            <div class="board-header-inner">
                <div class="board-title-wrap">
                    <p class="breadcrumb">새소식 &gt; 공지사항</p>
                    <h1>공지사항 안내</h1>
                    <p class="board-desc">
                        YB WEB의 최신 공지 및 시스템 변경 사항을 확인하실 수 있습니다.
                    </p>
                </div>
            </div>
        </section>

        <!-- 검색/필터 영역 -->
        <section class="board-toolbar-section">
            <div class="board-toolbar-inner">

                <!-- 총 건수 동적 처리 -->
                <div class="board-count">
                    총 <span th:text="${totalCount}">0</span>건의 공지사항이 있습니다.
                </div>

                <form class="board-search" method="get">
                    <select name="type">
                        <option value="">구분 전체</option>
                        <option value="patch">패치 노트</option>
                        <option value="system">시스템</option>
                        <option value="event">이벤트</option>
                        <option value="etc">기타</option>
                    </select>

                    <input type="text" name="keyword"
                           placeholder="공지 내용 검색"
                           th:value="${keyword}">
                    <button type="submit">검색</button>
                </form>

            </div>
        </section>

        <!-- 🔹 상단 주요 공지 카드 (상단 공지 고정된 글) -->
        <!-- posts 목록이 있고, 그 첫 번째 글이 noticePin=true 인 경우에만 노출 -->
        <section class="update-featured-section"
                 th:if="${!#lists.isEmpty(posts) and posts[0].noticePin}">
            <div class="board-inner"
                 th:with="featured=${posts[0]}">

                <article class="update-featured-card">
                    <div class="badge-line">
                        <span class="badge badge-type">공지사항</span>
                        <span class="badge badge-new" th:if="${featured.isNew}">NEW</span>
                    </div>

                    <h2 class="featured-title">
                        <a th:href="@{/board/{type}/{id}(
                                        type=${boardType.name()},
                                        id=${featured.id}
                                    )}"
                           th:text="${featured.title}">
                            [정식 서버] 겨울 시즌 대규모 업데이트 안내
                        </a>
                    </h2>

                    <!-- 내용 요약 : 줄바꿈 제거 후 150자 정도만 표시 -->
                    <p class="featured-desc"
                       th:text="${#strings.abbreviate(#strings.replace(featured.content, '\n', ' '), 150)}">
                        신규 레이드 &lt;프로스트 로드&gt;, 신규 클래스, 장비 성장 동선 개편과
                        각종 편의성 개선 사항이 적용됩니다. 자세한 내용은 아래 본문을 통해 확인해 주세요.
                    </p>

                    <div class="featured-meta">
                        <span class="date"
                              th:text="${#temporals.format(featured.createdAt, 'yyyy.MM.dd')}">
                            2025.12.01
                        </span>
                        <span class="divider">|</span>
                        <span class="view"
                              th:text="|조회 ${featured.viewCount}|">
                            조회 3,250
                        </span>
                    </div>
                </article>

            </div>
        </section>

        <!-- 공지 목록 테이블 -->
        <section class="board-list-section">
            <div class="board-inner">

                <table class="board-table">
                    <colgroup>
                        <col style="width: 110px;">
                        <col>
                        <col style="width: 120px;">
                        <col style="width: 110px;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th>구분</th>
                        <th>제목</th>
                        <th>등록일</th>
                        <th>조회수</th>
                    </tr>
                    </thead>
                    <tbody>

                        <!-- 게시글이 없을 때 -->
                        <tr th:if="${#lists.isEmpty(posts)}">
                            <td colspan="4" class="no-data">
                                등록된 공지사항이 없습니다.
                            </td>
                        </tr>

                        <!-- 게시글 목록 -->
                        <tr th:each="post : ${posts}"
                            th:classappend="${post.noticePin} ? ' row-pin'">

                            <!-- 구분 -->
                            <td>
							    <span class="tag"
							          th:classappend="${post.noticePin} ? ' pin' : ' type-etc'">
							        공지
							    </span>
							</td>

                            <!-- 제목 -->
							<td class="title-cell">
							    <a th:href="@{/board/{type}/{id}(
							                    type=${boardType.name()},
							                    id=${post.id}
							                )}"
							       class="title-link">
							
							        <!-- 실제 제목 텍스트 -->
							        <span th:text="${post.title}">제목</span>
							
							        <!-- 🔒 비밀글일 때만 자물쇠 표시 -->
							        <span th:if="${post.secret}" class="secret-icon">🔒</span>
							    </a>
							
							    <span class="badge-mini" th:if="${post.isNew}">NEW</span>
							</td>

                            <!-- 날짜 -->
                            <td th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">
                                2025.11.29
                            </td>

                            <!-- 조회수 -->
                            <td th:text="${post.viewCount}">0</td>
                        </tr>

                    </tbody>
                </table>

                <!-- 페이지네이션 -->
				<div class="pagination" th:if="${totalPages > 1}">

				    <!-- 맨 처음 페이지 (<<) -->
				    <a class="page-btn"
				       th:href="@{/board/{type}(type=${#strings.toLowerCase(boardType.name())},
				                                page=1,
				                                keyword=${keyword})}"
				       th:classappend="${page == 1} ? ' disabled'">
				        &laquo;
				    </a>

				    <!-- 이전 블록 (<) -->
				    <a class="page-btn"
				       th:if="${hasPrevBlock}"
				       th:href="@{/board/{type}(type=${#strings.toLowerCase(boardType.name())},
				                                page=${prevBlockPage},
				                                keyword=${keyword})}">
				        &lsaquo;
				    </a>
				    <span class="page-btn disabled"
				          th:if="${!hasPrevBlock}">
				        &lsaquo;
				    </span>

				    <!-- 페이지 숫자 5개 블록 -->
				    <a class="page-btn"
				       th:each="p : ${#numbers.sequence(startPage, endPage)}"
				       th:text="${p}"
				       th:classappend="${p == page} ? ' active'"
				       th:href="@{/board/{type}(type=${#strings.toLowerCase(boardType.name())},
				                                page=${p},
				                                keyword=${keyword})}">
				    </a>

				    <!-- 다음 블록 (>) -->
				    <a class="page-btn"
				       th:if="${hasNextBlock}"
				       th:href="@{/board/{type}(type=${#strings.toLowerCase(boardType.name())},
				                                page=${nextBlockPage},
				                                keyword=${keyword})}">
				        &rsaquo;
				    </a>
				    <span class="page-btn disabled"
				          th:if="${!hasNextBlock}">
				        &rsaquo;
				    </span>

				    <!-- 맨 끝 페이지 (>>) -->
				    <a class="page-btn"
				       th:href="@{/board/{type}(type=${#strings.toLowerCase(boardType.name())},
				                                page=${totalPages},
				                                keyword=${keyword})}"
				       th:classappend="${page == totalPages} ? ' disabled'">
				        &raquo;
				    </a>
				</div>

                <!-- 글쓰기 버튼 -->
                <div class="board-write-wrap"
				     th:if="${loginMember != null 
				             and loginMember.role != null 
				             and #strings.toUpperCase(loginMember.role).contains('ADMIN')}">
				    <a th:href="@{'/board/NOTICE/write'}" class="btn-write">글쓰기</a>
				</div>

            </div>
        </section>

    </main>

</div>

<!-- 공통 푸터 -->
    <th:block th:replace="layout/footer :: footer"></th:block>

</body>
</html>